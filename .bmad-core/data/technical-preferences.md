<!-- Powered by BMAD™ Core -->

# 项目管理 Agent MVP 技术偏好和开发模式

## 项目概述
基于OpenWebUI + PostgreSQL + 飞书机器人的科研项目管理智能应用，实现任务管理、进度跟踪、到期提醒等核心功能。

## 技术栈偏好

### 后端技术栈
- **框架**: OpenWebUI + Python 3.9+ + FastAPI
- **数据库**: PostgreSQL 15+ (支持pgvector扩展)
- **ORM**: SQLAlchemy 2.0+ (异步支持)
- **任务调度**: APScheduler 3.10+
- **数据验证**: Pydantic 2.0+
- **飞书集成**: feishu-sdk 1.0+
- **数据导出**: openpyxl (Excel), reportlab (PDF)
- **自然语言处理**: 正则表达式 + 自定义NLP处理器

### 前端技术栈
- **框架**: React 18+ / Vue.js 3+ (根据团队技术栈选择)
- **UI组件库**: Ant Design / Element UI
- **状态管理**: Redux Toolkit / Pinia
- **HTTP客户端**: Axios
- **图表库**: ECharts (甘特图、燃尽图)
- **构建工具**: Vite / Webpack

### 数据库设计偏好
- **命名规范**: snake_case (表名、字段名)
- **字段约束**: 包含大写字母的字段名必须用双引号包围
- **函数命名**: 所有函数添加user_前缀
- **类型一致性**: 函数返回值和声明中的类型必须一致
- **索引策略**: 为常用查询字段创建索引
- **扩展支持**: 预留多Agent协作的数据库结构

### 插件开发偏好
- **架构模式**: 基于OpenWebUI原生插件系统
- **装饰器使用**: @function定义工具函数，@webhook处理飞书消息
- **配置管理**: plugin.yaml配置文件 + 环境变量
- **热加载**: 支持插件动态更新和热重载
- **模块化**: 核心业务逻辑、工具函数、服务层分离

## 开发规范偏好

### Python代码规范
- **版本要求**: Python 3.9+
- **代码风格**: 遵循PEP 8规范
- **类型注解**: 强制使用类型注解
- **文档字符串**: 函数和类必须有Google风格的文档字符串
- **命名规范**: 
  - 变量/函数: snake_case
  - 类名: PascalCase
  - 常量: UPPER_CASE
- **导入顺序**: stdlib → third_party → local
- **工具链**: black (格式化) + ruff (检查) + isort (导入排序)

### 数据库操作偏好
- **连接管理**: 使用连接池，支持异步操作
- **事务处理**: 合理使用事务，确保数据一致性
- **查询优化**: 使用索引，避免N+1查询问题
- **错误处理**: 完善的数据库异常处理机制
- **备份策略**: 定期备份，支持数据恢复

### 飞书集成偏好
- **消息处理**: 支持自然语言输入解析
- **Webhook**: 异步处理飞书消息
- **错误重试**: 消息发送失败时的重试机制
- **用户映射**: 飞书用户ID与系统用户关联
- **权限控制**: 基于角色的消息访问控制

## 架构设计偏好

### 系统架构
- **分层架构**: 表示层 → 业务逻辑层 → 数据访问层 → 基础设施层
- **插件化**: 基于OpenWebUI插件机制，支持功能模块化
- **Agent模式**: 进度Agent为核心，预留需求Agent和风险Agent扩展
- **微服务**: 每个Agent可独立部署和扩展

### 数据流设计
- **统一数据源**: PostgreSQL作为唯一数据源
- **实时同步**: Web前端和飞书机器人数据实时同步
- **事件驱动**: 任务状态变更触发相关事件
- **缓存策略**: 合理使用缓存提升性能

### 扩展性设计
- **接口预留**: 为多Agent协作预留标准接口
- **配置驱动**: 通过配置文件控制功能开关
- **插件热插拔**: 支持插件动态加载和卸载
- **API版本化**: 支持API版本管理和向后兼容

## 部署和运维偏好

### 容器化部署
- **Docker**: 使用Docker容器化部署
- **Docker Compose**: 多服务编排管理
- **多阶段构建**: 优化镜像大小
- **健康检查**: 容器健康状态监控

### 环境管理
- **环境隔离**: 开发、测试、生产环境分离
- **配置管理**: 环境变量 + 配置文件
- **密钥管理**: 敏感信息加密存储
- **日志管理**: 结构化日志 + 日志轮转

### 监控和告警
- **应用监控**: 关键指标监控
- **数据库监控**: 连接数、查询性能监控
- **飞书API监控**: 调用频率、成功率监控
- **告警机制**: 异常情况及时告警

## 测试策略偏好

### 测试类型
- **单元测试**: 核心业务逻辑单元测试
- **集成测试**: 数据库、飞书API集成测试
- **端到端测试**: 完整业务流程测试
- **性能测试**: 并发用户、大数据量测试

### 测试工具
- **测试框架**: pytest + pytest-asyncio
- **测试数据库**: 使用测试专用数据库
- **Mock工具**: 飞书API等外部服务Mock
- **覆盖率**: 代码覆盖率 > 80%

## 安全偏好

### 数据安全
- **传输加密**: HTTPS/SSL加密传输
- **存储加密**: 敏感数据加密存储
- **访问控制**: 基于角色的权限控制
- **数据脱敏**: 日志和错误信息脱敏

### 接口安全
- **认证机制**: JWT Token认证
- **API限流**: 防止API滥用
- **输入验证**: 严格的输入参数验证
- **SQL注入防护**: 使用参数化查询

## 性能优化偏好

### 响应时间目标
- **Web前端**: 页面响应时间 ≤ 2秒
- **飞书消息**: 消息发送延迟 ≤ 30秒
- **数据库查询**: 查询响应时间 ≤ 500ms
- **API接口**: 接口响应时间 ≤ 1秒

### 并发支持
- **任务管理**: 支持500+任务管理
- **用户并发**: 支持50+用户并发
- **飞书消息**: 支持100+消息/分钟
- **数据库连接**: 连接池管理，避免连接泄漏

### 资源使用
- **内存使用**: 应用内存使用 < 2GB
- **CPU使用**: CPU使用率 < 70%
- **磁盘空间**: 数据存储 < 10GB
- **网络带宽**: 合理控制网络使用

## 开发流程偏好

### 版本控制
- **分支策略**: Git Flow分支模型
- **提交规范**: 使用Conventional Commits规范
- **代码审查**: 所有代码必须经过审查
- **自动化**: CI/CD自动化部署

### 文档管理
- **API文档**: 使用OpenAPI规范
- **代码文档**: 内联注释 + 文档字符串
- **架构文档**: 保持架构文档更新
- **用户手册**: 详细的用户使用指南

### 质量保证
- **代码质量**: 静态代码分析
- **安全扫描**: 依赖包安全扫描
- **性能测试**: 定期性能基准测试
- **用户反馈**: 收集用户使用反馈

## 特殊要求

### Windows系统适配
- **文件路径**: 使用Windows兼容的文件路径操作
- **命令行**: 支持PowerShell和CMD命令
- **包管理**: 优先使用mamba，避免在base环境安装业务包
- **编码处理**: 正确处理中文编码问题

### 中文支持
- **界面语言**: 所有用户界面使用中文
- **错误信息**: 错误提示使用中文
- **日志记录**: 日志信息使用中文
- **文档注释**: 代码注释使用中文

### 科研项目特色
- **PMBOK/PRINCE2**: 支持项目管理方法论
- **知识库**: 集成项目管理知识库
- **多Agent协作**: 支持进度、需求、风险Agent协作
- **可视化**: 支持甘特图、燃尽图等项目管理图表
