# Story 4.2: 延期提醒功能

## Status
Draft

## Story
**As a** 项目经理，
**I want** 系统能够提醒已延期的任务，
**so that** 能够及时处理延期问题。

## Acceptance Criteria

1. 系统自动识别已过期未完成的任务
2. 延期提醒同时发送给负责人和项目经理
3. 提醒信息包含延期天数和任务详情
4. 支持设置提醒频率（每日/每周）
5. 延期任务在列表中特殊标记

## Tasks / Subtasks

- [ ] 延期检测逻辑 (AC: 1)
  - [ ] 实现延期任务识别算法
  - [ ] 实现延期状态更新逻辑
  - [ ] 实现延期天数计算
  - [ ] 实现延期任务标记
- [ ] 延期提醒功能 (AC: 2, 3)
  - [ ] 实现延期提醒发送逻辑
  - [ ] 实现多收件人通知
  - [ ] 实现延期信息生成
  - [ ] 实现提醒优先级设置
- [ ] 提醒频率设置 (AC: 4)
  - [ ] 创建提醒频率配置
  - [ ] 实现每日提醒逻辑
  - [ ] 实现每周提醒逻辑
  - [ ] 实现提醒频率切换
- [ ] 延期任务标记 (AC: 5)
  - [ ] 实现延期任务视觉标识
  - [ ] 实现延期天数显示
  - [ ] 实现延期任务筛选
  - [ ] 实现延期任务排序

## Dev Notes

### 延期定义
- **延期条件**: 截止日期已过且状态不是"完成"
- **延期天数**: 当前日期 - 截止日期
- **延期状态**: 自动更新任务状态为"延期"

### 提醒规则
- **提醒对象**: 任务负责人 + 项目经理
- **提醒频率**: 可配置（每日/每周）
- **提醒内容**: 任务标题、延期天数、任务详情
- **提醒优先级**: 高优先级通知

### 数据库表设计
- **overdue_tasks表**: id, task_id, overdue_days, first_overdue_at, last_reminder_at
- **reminder_frequency表**: id, user_id, frequency_type, is_enabled

### 延期任务标识
- **颜色标识**: 红色边框或背景
- **图标标识**: 警告图标
- **文字标识**: "延期X天"
- **排序优先**: 延期任务置顶显示

### API端点
- `GET /api/tasks/overdue` - 获取延期任务列表
- `POST /api/reminders/overdue` - 发送延期提醒
- `PUT /api/reminders/frequency` - 更新提醒频率

### 提醒模板
- **标题**: "任务延期提醒 - {task_title}"
- **内容**: 包含延期天数、任务详情、处理建议
- **链接**: 任务详情页面链接

### Testing
- **测试文件位置**: `tests/unit/reminders/`, `tests/integration/reminders/`
- **测试标准**: 延期检测测试、提醒发送测试
- **测试框架**: pytest + pytest-asyncio
- **测试要求**: 延期计算测试、多收件人测试、频率设置测试

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-01-15 | 1.0 | 初始故事创建 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
待开发时填写

### Debug Log References
待开发时填写

### Completion Notes List
待开发时填写

### File List
待开发时填写

## QA Results
待QA审查时填写
