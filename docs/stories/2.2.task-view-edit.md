# Story 2.2: 任务查看与编辑

## Status
Draft

## Story
**As a** 项目成员，
**I want** 能够查看和编辑任务信息，
**so that** 能够更新任务状态和内容。

## Acceptance Criteria

1. 用户能够查看任务的完整信息
2. 用户能够编辑任务的所有字段
3. 任务状态支持更新（未开始/进行中/完成/延期）
4. 任务更新后自动记录修改时间
5. 只有任务负责人或项目经理能够编辑任务

## Tasks / Subtasks

- [ ] 任务详情页面 (AC: 1)
  - [ ] 创建任务详情展示组件
  - [ ] 实现任务信息完整显示
  - [ ] 实现任务历史记录显示
  - [ ] 实现任务状态可视化
- [ ] 任务编辑功能 (AC: 2, 3)
  - [ ] 创建任务编辑表单
  - [ ] 实现字段编辑功能
  - [ ] 实现状态更新功能
  - [ ] 实现权限验证逻辑
- [ ] 任务更新API (AC: 4, 5)
  - [ ] 创建任务更新API端点
  - [ ] 实现权限验证中间件
  - [ ] 实现修改时间记录
  - [ ] 实现更新历史记录
- [ ] 前端集成 (AC: 1, 2, 3)
  - [ ] 实现任务详情页面路由
  - [ ] 实现编辑模式切换
  - [ ] 实现状态更新按钮
  - [ ] 实现权限控制显示

## Dev Notes

### 任务状态定义
- **未开始**: 任务刚创建，尚未开始
- **进行中**: 任务正在执行中
- **完成**: 任务已完成
- **延期**: 任务已超过截止日期

### 权限控制规则
- 任务负责人可以编辑自己负责的任务
- 项目经理可以编辑所有任务
- 其他用户只能查看任务信息

### 数据库表设计
- **tasks表**: 增加updated_at字段
- **task_history表**: id, task_id, field_name, old_value, new_value, changed_by, changed_at

### API端点
- `GET /api/tasks/{id}` - 获取任务详情
- `PUT /api/tasks/{id}` - 更新任务信息
- `PUT /api/tasks/{id}/status` - 更新任务状态
- `GET /api/tasks/{id}/history` - 获取任务历史记录

### 状态更新规则
- 状态只能按顺序更新：未开始 → 进行中 → 完成
- 延期状态可以随时设置
- 状态变更需要记录操作人和时间

### Testing
- **测试文件位置**: `tests/unit/tasks/`, `tests/integration/tasks/`
- **测试标准**: 权限控制测试、状态更新测试
- **测试框架**: pytest + pytest-asyncio
- **测试要求**: 权限验证测试、历史记录测试、状态转换测试

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-01-15 | 1.0 | 初始故事创建 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
待开发时填写

### Debug Log References
待开发时填写

### Completion Notes List
待开发时填写

### File List
待开发时填写

## QA Results
待QA审查时填写
