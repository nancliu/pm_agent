# Story 1.3: 基础用户管理

## Status
Ready for Review

## Story
**As a** 项目经理，
**I want** 能够管理团队成员信息，
**so that** 能够正确分配任务。

## Acceptance Criteria

1. 项目经理能够添加新团队成员
2. 项目经理能够编辑团队成员信息
3. 项目经理能够删除团队成员
4. 系统支持用户角色区分（项目经理/成员）
5. 用户信息变更后能够正确同步到任务分配

## Tasks / Subtasks

- [X] 用户管理界面 (AC: 1, 2, 3)
  - [X] 创建用户管理页面
  - [X] 实现用户列表展示
  - [X] 实现添加用户表单
  - [X] 实现编辑用户表单
  - [X] 实现删除用户确认
- [X] 用户管理API (AC: 1, 2, 3)
  - [X] 创建获取用户列表API
  - [X] 创建添加用户API
  - [X] 创建更新用户API
  - [X] 创建删除用户API
- [X] 角色管理功能 (AC: 4)
  - [X] 实现角色权限控制
  - [X] 实现角色分配功能
  - [X] 实现角色验证中间件
- [X] 数据同步功能 (AC: 5)
  - [X] 实现用户信息变更通知
  - [X] 实现任务分配同步更新
  - [X] 实现缓存更新机制

## Dev Notes

### 用户角色定义
- **项目经理**: 可以管理所有用户和任务
- **成员**: 只能查看和编辑自己的任务
- **管理支持人员**: 协助项目经理管理项目

### 数据库表设计
- **users表**: id, username, email, role, status, created_at, updated_at
- **user_roles表**: id, user_id, role_name, assigned_by, assigned_at

### API端点
- `GET /api/users` - 获取用户列表
- `POST /api/users` - 添加新用户
- `PUT /api/users/{id}` - 更新用户信息
- `DELETE /api/users/{id}` - 删除用户
- `PUT /api/users/{id}/role` - 更新用户角色

### 权限控制
- 只有项目经理可以管理用户
- 用户只能查看和编辑自己的信息
- 角色变更需要权限验证

### Testing
- **测试文件位置**: `tests/unit/users/`, `tests/integration/users/`
- **测试标准**: 用户管理功能测试、权限控制测试
- **测试框架**: pytest + pytest-asyncio
- **测试要求**: 角色权限测试、数据同步测试

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-01-15 | 1.0 | 初始故事创建 | Sarah (PO) |
| 2024-01-15 | 1.1 | 完成用户管理API开发与测试 | Dev (James) |

## Dev Agent Record

### Agent Model Used
Dev (James)

### Debug Log References
- 用户管理API开发与集成
- 权限控制系统实现
- 用户CRUD功能测试
- 管理员权限测试

### Completion Notes List
- 实现完整的用户管理API路由 (user_routes.py)
- 添加用户数据模型与验证 (schemas.py)
- 集成用户路由到主应用 (main.py, run_app.py)
- 实现基于角色的权限控制
- 开发用户CRUD功能：列表、创建、更新、删除
- 实现用户搜索、过滤、分页功能
- 添加软删除功能（状态更新为inactive）
- 创建全面的集成测试覆盖所有功能
- 权限控制测试：管理员vs普通用户

### File List
- backend/plugins/pm_agent/user_routes.py (新建用户管理API路由)
- backend/plugins/pm_agent/schemas.py (更新用户相关Pydantic模型)
- backend/plugins/pm_agent/main.py (集成用户路由)
- run_app.py (集成用户路由)
- tests/integration/users/test_user_api.py (用户API集成测试)
- test_admin_features.py (管理员功能测试脚本)

## QA Results
待QA审查时填写
