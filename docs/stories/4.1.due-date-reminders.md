# Story 4.1: 到期提醒功能

## Status
Draft

## Story
**As a** 项目成员，
**I want** 系统能够自动提醒我即将到期的任务，
**so that** 能够及时完成任务。

## Acceptance Criteria

1. 系统每天自动检查即将到期的任务
2. 对截止时间在3天内的任务发送提醒
3. 提醒信息包含任务标题、截止时间、当前状态
4. 提醒通过系统通知或邮件发送
5. 用户能够查看提醒历史记录

## Tasks / Subtasks

- [ ] 定时任务调度 (AC: 1)
  - [ ] 配置APScheduler定时任务
  - [ ] 实现每日检查任务
  - [ ] 实现任务到期检查逻辑
  - [ ] 实现任务调度监控
- [ ] 提醒逻辑实现 (AC: 2, 3)
  - [ ] 实现到期任务查询
  - [ ] 实现提醒条件判断
  - [ ] 实现提醒信息生成
  - [ ] 实现提醒发送逻辑
- [ ] 通知发送功能 (AC: 4)
  - [ ] 实现系统通知发送
  - [ ] 实现邮件通知发送
  - [ ] 实现通知模板管理
  - [ ] 实现通知发送状态跟踪
- [ ] 提醒历史功能 (AC: 5)
  - [ ] 创建提醒历史表
  - [ ] 实现提醒记录存储
  - [ ] 创建提醒历史查看页面
  - [ ] 实现提醒历史查询API

## Dev Notes

### 提醒规则
- **检查频率**: 每天上午9:00
- **提醒条件**: 截止时间在3天内
- **提醒对象**: 任务负责人
- **提醒方式**: 系统通知 + 邮件通知

### 提醒信息内容
- 任务标题
- 截止时间
- 当前状态
- 剩余天数
- 任务详情链接

### 数据库表设计
- **reminder_logs表**: id, task_id, user_id, reminder_type, sent_at, status
- **notification_settings表**: id, user_id, email_enabled, system_enabled, reminder_days

### 定时任务配置
- **任务名称**: daily_task_reminder
- **执行时间**: 每天09:00
- **时区**: 系统时区
- **重试机制**: 失败后重试3次

### API端点
- `GET /api/reminders/history` - 获取提醒历史
- `POST /api/reminders/send` - 手动发送提醒
- `PUT /api/notifications/settings` - 更新通知设置

### 通知模板
- **邮件模板**: HTML格式，包含任务信息
- **系统通知**: JSON格式，包含任务链接
- **模板变量**: {task_title}, {due_date}, {status}, {days_left}

### Testing
- **测试文件位置**: `tests/unit/reminders/`, `tests/integration/reminders/`
- **测试标准**: 定时任务测试、通知发送测试
- **测试框架**: pytest + pytest-asyncio
- **测试要求**: 提醒逻辑测试、邮件发送测试、定时任务测试

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-01-15 | 1.0 | 初始故事创建 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
待开发时填写

### Debug Log References
待开发时填写

### Completion Notes List
待开发时填写

### File List
待开发时填写

## QA Results
待QA审查时填写
