# Story 1.1: 项目环境搭建与数据库配置

## Status

Ready for Review

## Story

**As a** 开发团队，
**I want** 设置完整的开发环境和数据库配置，
**so that** 能够开始项目开发工作。

## Acceptance Criteria

1. 项目使用OpenWebUI框架成功启动，能够访问基础界面
2. PostgreSQL数据库连接正常，能够执行基础查询
3. 开发环境支持热重载和调试功能
4. 项目代码结构清晰，包含必要的配置文件和文档
5. 数据库表结构创建成功，包含用户表和任务表的基础字段

## Tasks / Subtasks

- [X] 环境搭建任务 (AC: 1, 3)
  - [X] 安装Python 3.9+和Node.js 18+
  - [X] 安装PostgreSQL 15+
  - [X] 配置OpenWebUI开发环境
  - [X] 设置热重载和调试功能
- [X] 数据库配置任务 (AC: 2, 5)
  - [X] 创建PostgreSQL数据库
  - [X] 设计用户表结构
  - [X] 设计任务表结构
  - [X] 创建数据库迁移脚本
- [X] 项目结构任务 (AC: 4)
  - [X] 创建项目目录结构
  - [X] 配置必要的配置文件
  - [X] 创建README文档
  - [X] 设置版本控制

## Dev Notes

### 技术栈信息

- **后端**: OpenWebUI + FastAPI + Python 3.9+
- **数据库**: PostgreSQL 15+
- **前端**: React/Vue.js + OpenWebUI UI组件
- **部署**: Docker容器化部署

### 数据库设计

- **用户表**: 包含用户ID、用户名、密码、角色、创建时间等字段
- **任务表**: 包含任务ID、标题、描述、负责人、截止日期、状态、优先级等字段

### 项目结构

```
pm_agent/
├── backend/
│   ├── plugins/
│   │   └── pm_agent/
│   ├── core/
│   ├── services/
│   ├── models/
│   └── database/
├── frontend/
├── docs/
└── docker/
```

### Testing

- **测试文件位置**: `tests/unit/`, `tests/integration/`
- **测试标准**: 单元测试覆盖率>80%
- **测试框架**: pytest (Python), Jest (TypeScript)
- **测试要求**: 数据库连接测试、API端点测试

## Change Log

| Date       | Version | Description                                      | Author      |
| ---------- | ------- | ------------------------------------------------ | ----------- |
| 2025-09-04 | 1.0     | 初始故事创建                                     | Sarah (PO)  |
| 2025-09-04 | 1.1     | 实施环境与数据库：表创建、健康检查通过、文档完善 | James (Dev) |

## Dev Agent Record

### Agent Model Used

Dev (James) – Full Stack Developer

### Debug Log References

- 数据库容器启动与校验：`docker-compose up -d postgres`，`docker exec ... psql -c "\\dt"`
- 应用健康检查：`/api/pm_agent/health`
- 依赖安装：mamba env `pm_agent`，mamba 安装requirements等价包
- 运行方式：`python run_app.py`（开发热重载）/ `uvicorn run_app:app --host 0.0.0.0 --port 8000`

### Completion Notes List

- 已创建Docker化PostgreSQL并初始化：`users`、`tasks`、`task_history`
- 修复SQLAlchemy `text("SELECT 1")` 调用问题
- 统一ORM枚举小写以匹配数据库CHECK约束
- 接入健康检查并通过

### File List

- `docker-compose.yml`
- `docker/postgres/init/01-init-database.sql`
- `backend/plugins/pm_agent/`:
  - `main.py`, `config.py`, `database.py`, `models.py`, `schemas.py`, `routes.py`, `auth_routes.py`, `security.py`, `migrations.py`, `__init__.py`
- `run_app.py`
- `requirements.txt`, `env.example`, `README.md`
- 测试：`tests/unit/test_database.py`, `tests/integration/test_api.py`

## QA Results

待QA审查时填写
